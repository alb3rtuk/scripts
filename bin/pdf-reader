#!/usr/bin/env ruby

# This program requires pdftotext: $ brew install homebrew/cask/pdftotext
# This program requires fswatch:   $ brew install fswatch

require 'nimzo-lib'
require 'yaml'

PATH_CURRENT = File.expand_path(`pwd`)
PATH_FILE    = ARGV[0]

Nimzo::Terminal::error('Please specify a file to parse.') if PATH_FILE.nil? || PATH_FILE == ''

path_file_split = PATH_FILE.split('/')
path_file       = (path_file_split.length == 1) ? "#{PATH_CURRENT.gsub("\n", '')}/#{path_file_split[0]}" : PATH_FILE

Nimzo::Terminal::error("File not found: #{Nimzo::Terminal::format_directory(path_file)}") unless Nimzo::Files::file_exists(path_file)

Nimzo::Terminal::info("Processing: #{Nimzo::Terminal::format_directory(path_file)}")

`pdftotext #{path_file} /tmp/pdftotext.txt`

lines = `cat /tmp/pdftotext.txt`.force_encoding('iso-8859-1').split("\n")

`rm /tmp/pdftotext.txt`

lines.each do |line|
    line.strip!
    if line != ''
        puts "\x1B[38;5;156m#{line}\x1B[0m"
    end
end